## 4. 観測値の利用

### 4.1 観測値の取得
観測情報はある行の1つの変数に対して1つのDebugResultオブジェクトとして提供され，
複数の値情報(ValueInfoオブジェクト)を含んでいます．

ある観測ポイント`p`から`変数a`の観測情報を以下のように取得できます．


```java
Optional<DebugResult> dr = p.getResults("a")
```

また，ある観測ポイント`p`から観測可能なすべての変数の観測情報を取得するには以下のようにします．


```java
HashMap<String, DebugResult> drs = getResults()
```

DebugResultには複数の値情報が含まれている可能性があり，個々の値はValueInfoオブジェクトに格納されています．

あるDebugResultオブジェクト`result`から直近の観測値を取得するには，以下のようにします．


```java
ValueInfo vi = result.getLatestValue();
String value = vi.getValue();
```

ValueInfoのgetValue()では観測値はすべてStringで返ることに注意してください．

また，すべての観測値を取得するには，以下のようにします．


```java
ArrayList<ValueInfo> vis = result.getValues()
```

### 4.2 観測値の保持上限の設定
保持する観測値の数には上限が定められており，デフォルトでは100件となっていますが，以下のように変更可能です(保持上限を200に増やす例).なお，既に設定された観測ポイントには反映されません．


```java
DebugResult.setDefaultMaxRecordNoOfValue(200)
```

また観測ポイントの変数ごとに保持上限を設定することも可能です(あるPoint `p`の変数`a`の保持上限のみを200に増やす例)．この場合，設定が観測ポイントに即時反映されます．


```java
p.getResults("a").get().setMaxRecordNoOfValue(200)
```

### 4.3 Location情報の取得
あるDebugResultがどの行番号のどの変数についての情報なのか等を後から知りたい場合は，
以下のようにDebugResultからLocationオブジェクトを取り出します．


```java
var loc = result.getLocation();
int lineNumber = loc.getLineNumber();
String varName = loc.getVarName();
```

### 4.4 配列・インスタンスの観測

配列やインスタンスを観測した場合，配列の要素やインスタンスの持つフィールド値を展開することができます．

あるAクラスのインスタンス`a`のもつ全フィールドの直近の観測値を取得したい場合は以下のようにします．


```java
var dr = p.getResults("a").get();
var vi = dr.getLatestValue();
ArrayList<ValueInfo> fields = vi.ch();
```

ある配列`a`の持つ全要素の直近の観測値を取得したい場合も上記と同じコードになります．

現在，これらの機能はJPDAを用いたデバッグのみで提供されます．ProbeJを用いたデバッグの場合は`ch()`で空のArrayListが返ります．
